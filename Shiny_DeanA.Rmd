# Shiny course with Dean Attali

## Resources
* html builder functions: [link](https://www.rdocumentation.org/packages/shiny/versions/1.0.5/topics/builder)
* `colourpicker`: [link](https://github.com/daattali/colourpicker)
```{r}
library(colourpicker)

# ui
colourInput("col", "Select a colour", value = "orange")
```
* `plotly`: used for interactive plots. It has a function `ggplotly()` that converts any plot in `ggplot2` to `plotly`. [Link](https://plot.ly/r/). **WARNING**: a `plotly` plot is not a regular plot, so you'll have to define the `ui` and `server` functions like this:
```{r}
# ui
plotlyOutput("plot")

# server
renderPlotly(ggplotly(p))
```

With this example, the user will be able to zoom into regions, or see data points when hovering over the plot:
```{r}
p <- ggplot(gapminder,
            aes(gdpPercap, lifeExp)) +
            geom_point() +
            scale_x_log10()
library(plotly)
ggplotly(p)
```


## app adding a line of best fit with a checkbox
```{r}
# Define UI for the application
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      textInput("title", "Title", "GDP vs life exp"),
      numericInput("size", "Point size", 1, 1),
      # Add a checkbox for line of best fit
      checkboxInput("fit", "Add line of best fit", value = FALSE)
    ),
    mainPanel(
      plotOutput("plot")
    )
  )
)

# Define the server logic
server <- function(input, output) {
  output$plot <- renderPlot({
    p <- ggplot(gapminder, aes(gdpPercap, lifeExp)) +
      geom_point(size = input$size) +
      scale_x_log10() +
      ggtitle(input$title)
    
    # When the "fit" checkbox is checked, add a line
    # of best fit
    if (input$fit) {
      p <- p + geom_smooth(method = "lm")
    }
    p
  })
}

# Run the application
shinyApp(ui = ui, server = server)
```
## app with ggplotly
```{r}
# Load the plotly package
library(plotly)

ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      textInput("title", "Title", "GDP vs life exp"),
      numericInput("size", "Point size", 1, 1),
      checkboxInput("fit", "Add line of best fit", FALSE),
      colourInput("colour", "Point colour", value = "blue"),
      selectInput("continents", "Continents",
                  choices = levels(gapminder$continent),
                  multiple = TRUE,
                  selected = "Europe"),
      sliderInput("years", "Years",
                  min(gapminder$year), max(gapminder$year),
                  value = c(1977, 2002))
    ),
    mainPanel(
      # Replace the `plotOutput()` with the plotly version
      plotlyOutput("plot")
    )
  )
)

# Define the server logic
server <- function(input, output) {
  # Replace the `renderPlot()` with the plotly version
  output$plot <- renderPlotly({
    # Convert the existing ggplot2 to a plotly plot
    ggplotly({
      data <- subset(gapminder,
                     continent %in% input$continents &
                       year >= input$years[1] & year <= input$years[2])
      
      p <- ggplot(data, aes(gdpPercap, lifeExp)) +
        geom_point(size = input$size, col = input$colour) +
        scale_x_log10() +
        ggtitle(input$title)
      
      if (input$fit) {
        p <- p + geom_smooth(method = "lm")
      }
      p
    })
  })
}

shinyApp(ui = ui, server = server)
```
